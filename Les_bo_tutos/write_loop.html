<!DOCTYPE html>
<html>
<title>Écrire la même chose en boucle</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="../Styles/prism.css">
<link rel="shortcut icon" href="Media/bO.ico">
<link rel="stylesheet" href="style.css">

<style>

</style>
<body class="w3-light-grey dark4">

<!-- w3-content defines a container for fixed size centered content,
and is wrapped around the whole page content, except for the footer in this example -->
<div class="w3-content" style="max-width:1400px">

    <!-- Header -->
    <header class="w3-container w3-center w3-padding-32 dark1">
        <h1><b>Les bO tutos</b></h1>
        <!--<p>Welcome to the blog of <span class="w3-tag">unknown</span></p>-->
        <p id="typewriter"></p>
    </header>

    <!-- Grid -->
    <div class="w3-row">

        <!-- Blog entries -->
        <div class="w3-col l8 s12 dark2">
            <!-- Blog entry -->
            <div class="w3-card-4 w3-margin w3-white">
                <img src="Media/screenCapture.jpg" alt="newScreenRecorder" style="width:100%">
                <div class="w3-container dark3">
                    <h3><b>Écrire la même chose en boucle</b></h3>
                    <h5>Rédigé le <span class="w3-opacity">15/01/2021</span></h5>
                </div>

                <div class="w3-container dark3">
                    <p>Petit bonus à la fin de l'article</p>
                    <h2>1. Cas d'un unique caractère</h2>
                    <p>Une première solution, celle à laquelle vous avez sans doutes déjà pensé, c'est de resster appuyé
                        sur cette touche, cependant pour des soucis d'efficacité, je vous recommande de verifier que le
                        caractère sera répété au plus vite, pour cela allez dans le panneau de configuration chercher
                        les propriété du clavier et mettez la cadence de répétition au maximum (je vous conseil
                        également de mettre au maximum les autres curseurs c'est plus sympatique ainsi)</p>
                    <img src="Media/keyboardSettings.png" style="width:60%" class="center_img">
                    <p>Ensuite choisissez quelques chose pour appuyer sur votre touche, cela peut être votre doigt, un
                        cailloux, ... j'ai pour ma part utilisé la manivelle du volet qui était parfaite pour ma
                        configuration.</p>
                    <img src="Media/AAAAAAAAvolet.jpg" style="width:100%">
                    <p>Pour une répetition encore plus rapide, vous pouvez utiliser des macros via votre logiciel de
                        macro préféré.</p>
                    <p>Une solution assez puissante mais qui peut manquer de flexibilité est d'acheter un clavier
                        spécialisé dans le caractère que vous souhaitez reproduire</p>
                    <img src="Media/AAA_keyboard.jpg" style="width:100%">
                    <p>Cette solution est sans doute la plus onéreuse mais le clavier en question restera un objet de
                        curiosité et de décoration (remarque: vous pouvez seulement acheter les touches si vous voulez
                        conserver votre clavier).</p>

                    <h2>2. Cas général</h2>
                    <p>Passons aux choses serieuses, nous allons utiliser Python afin de produire ce que nous voulons
                        depuis le début, dans un premier temps avec Python seulement puis avec une librairie pour une
                        simplicité d'execution.</p>
                    <pre class="line-numbers"><code class="language-python">>>> 'A'*9
'AAAAAAAAA'</code></pre>
                    <pre class="line-numbers"><code class="language-python">>>> 'Aaaa aa'*9
'Aaaa aaAaaa aaAaaa aaAaaa aaAaaa aaAaaa aaAaaa aaAaaa aaAaaa aa'</code></pre>
                    <p>Je vais utiliser beaucoup de A aaaaaaaaaaaaaaaaaaaaaaa mais vous pouvez choisir ce que vous
                        voulez, même des lettres différentes les unes des autres si vous l'osez.</p>
                    <p>
                        Comme on est en Python, on peut faire bien plus, comme ne pas répeter exactement la même chose:
                    </p>
                    <pre class="line-numbers"><code class="language-python">>>> s=''
for i in range (8):
...     s+='A' + i*'a'
...
>>> s
'AAaAaaAaaaAaaaaAaaaaaAaaaaaaAaaaaaaa'</code></pre>
                    <pre class="line-numbers"><code class="language-python">>>> s=''
for i in range (8):
...     s+='A' + i*'a' + str(i)
...
>>> s
'A0Aa1Aaa2Aaaa3Aaaaa4Aaaaaa5Aaaaaaa6Aaaaaaaa7'</code></pre>
                    <pre class="line-numbers"><code class="language-python">>>> L=['aaAa', 'aAAa', 'a'*4, 'AAAAAAAaa']
>>> n=len(L)
>>> s=''
>>> for i in range(12):
...     s+=L[i%n]+'aA a'*(i//n)
...
>>> s
'aaAaaAAaaaaaAAAAAAAaaaaAaaA aaAAaaA aaaaaaA aAAAAAAAaaaA aaaAaaA aaA aaAAaaA aaA aaaaaaA aaA aAAAAAAAaaaA aaA a'</code></pre>
                    <p>Ou même en utilisant le code ASCII pour changer de lettre au fur et a mesure.</p>
                    <pre class="line-numbers"><code class="language-python">>>> a = ord('a')
>>> z = ord('z')
>>> s=''
>>> for i in range(16):
...     s+= chr(a + i)*i
...
>>> s
'bccdddeeeefffffgggggghhhhhhhiiiiiiiijjjjjjjjjkkkkkkkkkklllllllllllmmmmmmmmmmmmnnnnnnnnnnnnnooooooooooooooppppppppppppppp'</code></pre>
                    <p>Vous le comprennez sans doutes, le champ des possibilité est fou, quasi infini.</p>

                    <p>Mais vous me direz bien entendu "C'est bien gentil mais une fois que j'ai généré ma chaine en
                        python, il faut que j'aille faire moi même un copié collé dans le champ qui m'interesse". C'est
                        là qu'intervient la bibliothèque <a href="https://pypi.org/project/PyAutoGUI/">pyautogui</a>.
                    </p>
                    <pre class="line-numbers"><code class="language-bash">#!/bin/bash

# Default values
path=$HOME"/Videos/MyCaptures"
mkdir -p $path
maxTime=3600
name="mycapture"
doThePythonProcess=false
extension=".jpg"

# Get the options flags
while getopts t:p:f:F: option
do
case "${option}"
in
t) maxTime=${OPTARG};;
p) path=${OPTARG};;
f) name=${OPTARG};;
F) extension="."${OPTARG};;
esac
done

start=$SECONDS
count=1
while ((maxTime > ((SECONDS - start))));
do gnome-screenshot -f $path"/"$name"-"$count$extension;
count=$(($count+1));
done
</code></pre>
                    <p>Comme on va faire la suite en Python, on peut en profiter pour lancer le code python depuis ce
                        script</p>
                    <pre class="line-numbers"><code class="language-bash">#!/bin/bash

# Default values
path=$HOME"/Videos/MyCaptures"
mkdir -p $path
maxTime=3600
name="mycapture"
doThePythonProcess=false
extension=".jpg"

# Get the options flags
while getopts t:p:f:F:P option
do
case "${option}"
in
t) maxTime=${OPTARG};;
p) path=${OPTARG};;
f) name=${OPTARG};;
F) extension="."${OPTARG};;
P) doThePythonProcess=true;;
esac
done

start=$SECONDS
count=1
while ((maxTime > ((SECONDS - start))));
do gnome-screenshot -f $path"/"$name"-"$count$extension;
count=$(($count+1));
done

if $doThePythonProcess
then echo "run the python script here"
# qqch comme python pythonscript.py dir outName
fi</code></pre>
                    <p>Maintenant on va passer au code en Python qui va faire de ces images une video extremement fluide
                        et qualitative que même Spielberg vous enviera.</p>
                    <p>Pour ce faire, vous aurez besoin de:</p>
                    <ul>
                        <li>Python 3.X</li>
                        <li>La bibliothèque <a href="https://opencv.org/">OpenCV</a></li>
                    </ul>
                    <p>Et là c'est très simple, nous allons simplement 'coller' les images à la suite pour en faire une
                        vidéo comme sur le modèle suivant:</p>
                    <pre class="line-numbers"><code class="language-python">fourcc = cv.VideoWriter_fourcc(*'XVID')  # => .avi
out = cv.VideoWriter('../Data/a.avi', fourcc, 5, (width, lenght))
for imageIn in imagesIn:
    print(imageIn)
    frame = cv.imread(os.path.join(pathIn, imageIn))
    frame = cv.resize(frame, (width, lenght))
    out.write(frame)

# Release everything if job is finished
out.release()</code></pre>
                    <p>Nous allons donc réccupérer les images portant le bon nom, les ranger dans le bon sens et
                        enregistrer cela en vidéo. On va passer tout ce dont on a besoin en argument pour pouvoir
                        appeler le Python depuis notre code bash.</p>
                    <pre data-src="Downloads/screen_capture/script.py" data-download-link class="line-numbers"><code
                            class="language-python">import argparse
import os

import cv2 as cv

possible_extension = [".jpg", ".png"]


def get_extension(filename):
    _, ext = os.path.splitext(filename)
    return ext


def sort(imgList):
    extSize = len(get_extension(imgList[0]))
    beginIndex = imgList[0].index('-')
    tmp = []
    for i in imgList:
        tmp.append((i, int(i[beginIndex + 1:-extSize])))
    tmp = sorted(tmp, key=lambda tup: tup[1])
    return [f[0] for f in tmp]


ap = argparse.ArgumentParser()
ap.add_argument("-i", "--input", required=True,
                help="path to input directory containing the images")
ap.add_argument("-p", "--prefix", default="",
                help="prefix images from capture should have, to let the other ones if there is")
ap.add_argument("-o", "--output", required=True,
                help="path to output video file")
ap.add_argument("-l", "--lenght", type=int, default=5,
                help="lenght of output video (in s)")
ap.add_argument("-c", "--codec", type=str, default="MJPG",
                help="codec of output video")
args = vars(ap.parse_args())

pathIn = args["input"]
name_prefix = args["prefix"]
# /!\ don't give a name containing '-' or adapt the script!
if name_prefix != "":
    imagesIn = [f for f in os.listdir(pathIn) if
                (os.path.isfile(os.path.join(pathIn, f)) and
                 f.split('-')[0] == name_prefix and
                 get_extension(os.path.join(pathIn, f)) in possible_extension)]
else:
    imagesIn = [f for f in os.listdir(pathIn) if
                (os.path.isfile(os.path.join(pathIn, f)) and
                 get_extension(os.path.join(pathIn, f)) in possible_extension)]

imagesIn = sort(imagesIn)
# Define the codec and create VideoWriter object
fourcc = cv.VideoWriter_fourcc(*args["codec"])
# fourcc = cv.VideoWriter_fourcc(*'XVID')  # => .avi
# We will suppose that the resolution is the same for all images and is the wanted video
# resolution so we don't have to resize images
lenght, width, _ = cv.imread(os.path.join(pathIn, imagesIn[0])).shape
print(width, lenght)
out = cv.VideoWriter(args["output"], fourcc, len(imagesIn)/args["lenght"], (width, lenght))

for imageIn in imagesIn:
    # print(imageIn)
    frame = cv.imread(os.path.join(pathIn, imageIn))
    # frame = cv.resize(frame, (width, lenght))
    out.write(frame)

# Release everything if job is finished
out.release()
</code></pre>
                    <p>Maintenant il suffit d'appeler le script Python depuis notre script en Bash avec cette ligne:</p>
                    <pre class="line-numbers"><code class="language-bash">python script.py -i $path -p $name -o $name".mp4" -l $((SECONDS-start))
</code></pre>
                    <p>On en profite pour pouvoir stoper la capture avec Ctrl+C, ce qui donne finalement</p>
                    <pre data-src="Downloads/screen_capture/script.sh" data-download-link class="line-numbers"><code
                            class="language-bash">#!/bin/bash

# Default values
path=$HOME"/Videos/MyCaptures"
mkdir -p $path
maxTime=3
name="mycapture"
doThePythonProcess=false
extension=".jpg"

trap createVideo SIGINT
createVideo() {
   if $doThePythonProcess
   then python script.py -i $path -p $name -o $name".mp4" -l $((SECONDS-start))
   fi
   exit
}

# Get the options flags
while getopts t:p:f:F:P option
do
case "${option}"
in
t) maxTime=${OPTARG};;
p) path=${OPTARG};;
f) name=${OPTARG};;
F) extension="."${OPTARG};;
P) doThePythonProcess=true;;
esac
done

start=$SECONDS
count=1
while ((maxTime > ((SECONDS - start))));
do gnome-screenshot -f $path"/"$name"-"$count$extension;
count=$(($count+1));
done

echo "fin de la capture"

createVideo</code></pre>
                </div>

            </div>
            <hr>

            <!-- Commentaires -->
            <div class="w3-card-4 w3-margin w3-white">
                <div class="w3-container dark3">
                    <h3><b>Commentaires</b></h3>
                    <p><span class="w3-padding-large"><b>Comments </b> <span
                            class="w3-tag">3</span></span></p>
                </div>
                <div class="dark4">

                    <p>Vidéo un peu trop sacadée à mon gout, mais parfait pour des timelapses par exemple. Bon tuto! :
                        )</p>
                </div>

            </div>
        </div>


        <!-- Introduction menu -->
        <div class="w3-col l4">
            <!-- About Card -->
            <div class="w3-card w3-margin w3-margin-top">
                <img src="../Media/Avatar.png" style="width:100%">
                <div class="w3-container w3-white">
                    <h4><b>AxxA</b></h4>
                    <p>Ce tutoriel est le resultat d'heures d'ennui il y a quelques années, je tennais à faire partager
                        cette avancée majeure.</p>
                </div>
            </div>
            <hr>

            <!-- Posts -->
            <div class="w3-card w3-margin">
                <div class="w3-container w3-padding">
                    <h4>Popular Posts</h4>
                </div>
                <ul class="w3-ul w3-hoverable w3-white">
                    <li class="w3-padding-16">
                        <img src="/w3images/workshop.jpg" alt="Image" class="w3-left w3-margin-right"
                             style="width:50px">
                        <span class="w3-large">Lorem</span><br>
                        <span>Sed mattis nunc</span>
                    </li>
                    <li class="w3-padding-16">
                        <img src="/w3images/gondol.jpg" alt="Image" class="w3-left w3-margin-right"
                             style="width:50px">
                        <span class="w3-large">Ipsum</span><br>
                        <span>Praes tinci sed</span>
                    </li>
                    <li class="w3-padding-16">
                        <img src="/w3images/skies.jpg" alt="Image" class="w3-left w3-margin-right"
                             style="width:50px">
                        <span class="w3-large">Dorum</span><br>
                        <span>Ultricies congue</span>
                    </li>
                    <li class="w3-padding-16 w3-hide-medium w3-hide-small">
                        <img src="/w3images/rock.jpg" alt="Image" class="w3-left w3-margin-right"
                             style="width:50px">
                        <span class="w3-large">Mingsum</span><br>
                        <span>Lorem ipsum dipsum</span>
                    </li>
                </ul>
            </div>
            <hr>

            <!-- Labels / tags -->
            <div class="w3-card w3-margin">
                <div class="w3-container w3-padding">
                    <h4>Tags</h4>
                </div>
                <div class="w3-container w3-white">
                    <p><span class="w3-tag w3-black w3-margin-bottom">Travel</span> <span
                            class="w3-tag w3-light-grey w3-small w3-margin-bottom">New York</span> <span
                            class="w3-tag w3-light-grey w3-small w3-margin-bottom">London</span>
                        <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">IKEA</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">NORWAY</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">DIY</span>
                        <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Ideas</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">Baby</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">Family</span>
                        <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">News</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">Clothing</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">Shopping</span>
                        <span class="w3-tag w3-light-grey w3-small w3-margin-bottom">Sports</span> <span
                                class="w3-tag w3-light-grey w3-small w3-margin-bottom">Games</span>
                    </p>
                </div>
            </div>

            <!-- END Introduction Menu -->
        </div>

        <!-- END GRID -->
    </div>
    <br>

    <!-- END w3-content -->
</div>

<!-- Footer -->
<footer class="w3-container w3-dark-grey w3-padding-32 w3-margin-top">
    <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
</footer>
<script>
    var i = 0;
    var txt = 'Bienvenue sur les bO tutos, j\'espère que vous trouverez de quoi résoudre vos soucis grace à notre contenu qualitatif';
    /* The text */
    var speed = 50;

    /* The speed/duration of the effect in milliseconds */

    function typeWriter() {
        if (i < txt.length) {
            document.getElementById("typewriter").innerHTML += txt.charAt(i);
            i++;
            setTimeout(typeWriter, speed);
        }
    }

    setInterval(typeWriter, 3000);


</script>
<script src="../Scripts/prism.js"></script>
</body>
</html>
